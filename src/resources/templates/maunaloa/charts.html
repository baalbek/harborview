<!DOCTYPE html>
<html lang="en">
<head>
    <!--
    <title>Maunaloa - Charts</title>
    -->
    <title>Visual Studio Web Example</title>
    <meta charset="UTF-8">
    {% include "templates/head.html" %}
    <script src="/js/elm/maunaloa/elm-charts.js"></script>
</head>
<body>
    <div class="logo"></div>
    <div class="container">
        <div id="my-app"></div>
    </div>
    <div style="position: absolute; top:200px; left:200px;">
        <canvas id="my-canvas" width="1300" height="600"></canvas>
    </div>
    <div id="buttons">
        <input type="button" id="clear" value="Clear">
    </div>
    <script type="text/javascript">
        var node = document.getElementById('my-app');
        var app = Elm.Maunaloa.Charts.embed(node);
        var drawCanvas = function (xss) {
          var graphs = xss[0];
          var xs = xss[1];
          var strokes = xss[2];
          var canvas = document.getElementById('my-canvas');
          var ctx = canvas.getContext("2d");
          ctx.clearRect(0,0,ctx.width,ctx.height);
          /*
          ctx.fillStyle="#abffff";
          ctx.fillRect(0,0,1300,600);
          */
          for (var i = 0; i < graphs.length; ++i) {
              var curStroke = strokes[i] === undefined ? "#000000" : strokes[i];
              var ys = graphs[i];
              drawGraph(ctx,xs,ys,curStroke)
          }
        }
        var drawGraph = function (ctx,xs,ys,strokeStyle) {
          if (xs.length !== ys.length) {
            return;
          }
          ctx.lineWidth = 0.5;
          // ctx.setLineDash([5,10]);
          ctx.strokeStyle = strokeStyle; // "#FF0000";
          ctx.moveTo(xs[0],ys[0]);
          for (var i = 1; i < xs.length; ++i) {
            var y = ys[i];
            var x = xs[i];
            ctx.lineTo(x,y);
          }
          ctx.stroke();
          ctx.closePath();
        }
        app.ports.drawCanvas.subscribe(drawCanvas);
        document.getElementById('clear').addEventListener('click', function() {
            var canvas = document.getElementById('my-canvas');
            var ctx = canvas.getContext("2d");
            ctx.clearRect(0, 0, ctx.width, ctx.height);
            alert("Did it clear?");
        }, false);
    </script>
</body>
</html>
